version: 1

backend:
  phases:
    preBuild:
      commands:
        # 1) se placer dans le dossier de la Lambda
        - cd amplify/backend/function/userHandler/src
        # 2) installer pipenv + dépendances (boto3, moto, pytest…)
        - pip install pipenv
        - pipenv install --dev
        # 3) lancer les tests
        - pipenv run pytest -q
    build:
      commands:
        # revenir à la racine pour amplify push
        - cd ../../../..
        - amplifyPush --simple

frontend:
  phases:
    build:
      commands: []
  artifacts:
    baseDirectory: /
    files:
      - '**/*'
  cache:
    paths: []
